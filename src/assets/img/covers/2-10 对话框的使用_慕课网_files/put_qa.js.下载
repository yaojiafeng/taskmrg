define("qacommon/js/put_qa",["require","juicer","ueditor"],function(){var t,e,i,n,a={fns:{},on:function(t,e,i){"undefined"==typeof i&&(i=e,e=this),this.fns[t]||(this.fns[t]=[]),i.ctx=e,this.fns[t].push(i)},emit:function(t,e){for(var i=this.fns[t],n=0;n<i.length;n++)i[n].call(i[n].ctx,e)}},r=function(t){return"string"==typeof t?t.replace(/&lt;/g,"<").replace(/&gt;/g,">"):""},u=function(t){var e={data:[]};return t.length<=0?$.extend(e,{callType:"search"}):($.each(t,function(t,i){e.data.push({mid:i.media_id,chapter_seq:i.chapter_seq,media_seq:i.media_seq,media_title:i.media_title,title:i.highlight,uid:i.uid,user_img:i.portrait,answers:i.answers,view_num:i.view_num,create_time:i.create_time,answer_type:i.reply.type,answer_uid:i.reply.uid,answer_uname:i.reply.reply_nickname,answer_description:r(i.reply.description),answer_role_id:i.reply.user_role_id,qid:i.id,currentuid:OP_CONFIG.userInfo?OP_CONFIG.userInfo.uid:"",cid:s.cid})}),$.extend(e,{callType:"search",page:s.page,headimg:"lesson"==s.page?"hide":"show"}))},d=function(t){var e={data:[]};return t.length<=0?$.extend(e,{callType:"search"}):($.each(t,function(t,i){e.data.push({mid:i.media_id,chapter_seq:i.chapter_seq,media_seq:i.media_seq,media_title:"",title:i.title,uid:i.uid,user_img:i.head,answers:i.answers,view_num:i.view_num,create_time:i.create_time,answer_type:5,answer_uid:"",answer_uname:"",answer_description:"",answer_role_id:"",qid:i.id,currentuid:i.uid,cid:s.cid})}),$.extend(e,{callType:"prepend",page:s.page,headimg:"lesson"==s.page?"hide":"show"}))},s={input:".qa-input-text",close:".qa-input-close",button:"qa-input-button",qaList:"#qaListContainer",search:".js-qa-search-list",page:"qa",cid:"-1"},o=null,c=".qa-search-tip",l=null,p={search:"/learn/searchques"},h=1,m=function(t){t?($(s.close).show(),$(s.search).show(),$(s.qaList).hide()):($(s.close).hide(),$(s.search).hide(),$(s.qaList).show())},f=1;return n={init:function(){var e="putQAeditor"+h;this.id=e,UE.delEditor(t),t=UE.getEditor(e,{initialFrameHeight:120,initialFrameWidth:"100%",autoFloatEnabled:!1,initialContent:"问题补充（选填）：请详细描述你的问题，贴出相关代码或截图，并告知你的操作步骤",autoClearinitialContent:!0,autoHeightEnabled:!1,initialStyle:"p{line-height:1.5em; font-size:13px; color:#444}"}),h++,this.getMediaList()},id:"",bindEvent:function(){var e=this;$("body").on("click",".put-qa-mbtn",function(){$(".put-qa-mlist:hidden")[0]?$(".put-qa-mlist").show():$(".put-qa-mlist").hide()}),$("body").on("focus",".qa-input-text",function(){$(".qa-input").addClass("focus")}).on("blur",".qa-input-text",function(){$(".qa-input").removeClass("focus")}),$("body").on("click",".put-qa-mlist span",function(){var t=$(this).attr("data-mid");$(".put-qa-mlist").hide(),e.medialistrender(t)}),$("body").on("click",".put-qa-close",function(){$("#putQAmodal").remove(),$("#putQAmodalopa").remove()}),$("body").on("click",".put-qa-change-word",function(){e.set_verCode()}),$("body").on("click",".put-qa-verifycode",function(){e.set_verCode()}),$("body").on("input propertychange",".put-qa-verify-text",function(){var t=$(this).val();4==t.length?$.ajax({url:"/user/checkverify",data:{id:"pubCourseQuestion",verify:t},dataType:"json",success:function(t){"0"==t.result?($(".put-qa-verify-right").show(),f=0,$(".put-qa-verify-reminder").html("")):($(".put-qa-verify-right").hide(),f=1,$(".put-qa-verify-reminder").html("验证码错误"))}}):($(".put-qa-verify-right").hide(),f=1)});var i=!1;$("body").on("click",".put-qa-submit",function(){if(""==$("#"+e.id).html())return void $.alert("请耐心等待输入框初始化完成");if(!i){i=!0;var n={},a=$(".put-qa-input").next(".put-qa-error"),r=$(".put-qa-verify-reminder");return n.cid=s.cid,n.mid=$(".put-qa-mlist-curr span").attr("data-mid"),n.title=$.trim($(".put-qa-input").val()),n.content=t.getContent(),n.verify=$.trim($(".put-qa-verify-text").val()),a.html(""),r.html(""),n.title?n.title.match(/\S/g).length<3?(a.html("标题长度应为3-80个字符"),void(i=!1)):n.title.length>80?(a.html("标题长度应为3-80个字符"),void(i=!1)):('<p id="initContent">问题补充（选填）：请详细描述你的问题，贴出相关代码或截图，并告知你的操作步骤</p>'==n.content&&(n.content=""),n.verify?1==f?(r.html("验证码错误"),void(i=!1)):void e.submit(n,function(){i=!1}):(r.html("请输入验证码"),void(i=!1))):(a.html("标题不能为空！"),void(i=!1))}})},submit:function(t,e){$.post("/learn/savequestion",t,function(t){if(0==t.result){var i=$("#qa-list-tpl").html(),n=d(t.data.list);$(s.qaList).find(".qa-list").prepend(juicer(i,n)),$("#putQAmodal").remove(),$("#putQAmodalopa").remove(),$(s.close).click(),$.alert("提交成功")}else $.alert(t.msg);e&&e()},"json")},medialistrender:function(t){var e="",i="",n=l;$.each(n,function(n,a){""==a.media_list&&(a.media_list=[]),$.each(a.media_list,function(a,r){var u="",d="";t?r.media_id==t&&(d="curr"):r.media_finished>1&&(d="curr"),u+='<span data-mid="'+r.media_id+'" class="'+d+'">',u+=n+1,u+="-",u+=a+1,u+=" ",u+=r.media_name,u+="</span>","curr"==d&&(i=u),e+=u})}),$(".put-qa-mlist").html(e),$(".put-qa-mlist-curr").html(i),""==$(".put-qa-mlist-curr").html()&&$(".put-qa-mlist").find("span").eq(0).click()},getMediaList:function(){var t=this;$.getJSON("/learn/ajaxmedialist",{cid:s.cid},function(e){if(1==e.result){l=e.data;var i=!1;OP_CONFIG.mid&&(i=OP_CONFIG.mid),t.medialistrender(i)}})},set_verCode:function(){var t=new Date;$(".put-qa-verifycode").attr("src","/learn/getcoursequestioncode?r="+t.getTime()),$(".put-qa-verify-right").hide()}},e={input:function(t){var e=$.trim(t.value);if(e.length<=0)return m(),!1;var i={words:e,cid:s.cid};$.getJSON(p.search,i,function(t){0==t.result&&a.emit("search/render",t.data)})},button:function(){i.render(),n.init()},searchrender:function(t){var e=u(t),i=$("#qa-list-tpl").html(),n=$(s.search);t.length<=0?$(c).hide():$(c).show(),n.html(juicer(i,e)),m(1),"function"==typeof s.callback&&setTimeout(function(){s.callback()},500)}},i={bindEvent:function(){$(s.input).on("keyup",function(){var t=this;clearTimeout(o),o=setTimeout(function(){e.input(t)},500)}),$(s.close).on("click",function(){$(s.input).val(""),m()}),$(s.button).on("click",e.button),a.on("search/render",e.searchrender)},init:function(t){s=$.extend(s,t||{}),i.bindEvent(),n.bindEvent()},render:function(){var t=$("#put-qa-tpl").html(),e=$("body"),i={id:h,value:""};i.value=$(s.input).val(),e.append(juicer(t,i))}},{init:i.init,EP:a,replacehtml:r}});