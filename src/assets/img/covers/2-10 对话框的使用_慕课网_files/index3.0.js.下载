define("lesson/index3.0",["juicer","pagination","lesson/js/common","store","common/js/antifake","qacommon/qa","/static/lib/mocoplayer/2.7.1/mocoplayer.js","common/js/autocomplete"],function(e,t,i,n,a,o){function s(e){var t=$("#mp-tip-tpl").html(),i=$("#mp-tip"),n={num:e.mp.point,desc:e.mp.desc};t=juicer(t,n),i.html(t).show().offset(),i.addClass("in"),setTimeout(function(){i.addClass("out").one("bsTransitionEnd",function(){i.hide().removeClass("in out")}).emulateTransitionEnd(300)},3e3)}function r(e){var t=$("#qa-tip-tpl").html(),i=$("#qa-tip");t=juicer(t,{data:e}),i.html(t).show(),$(".bottom-box").delegate(".js-change-qa","click",function(){var e=parseInt($(".showqa").attr("data-qanum")),t=$(this).data("sum"),i=Number(t-1),n=Number(e+1);e==i?n=0:n>i&&(n=0),$(".js-"+e).addClass("hideqa").removeClass("showqa"),$(".js-"+n).removeClass("hideqa").addClass("showqa")}),$(".qa-tip").delegate(".js-close","click",function(){$("#qa-tip").hide()})}function d(e){this.key=e.key,this.container=null,this.wrap=null,this.init(e)}var c={},l={},u={},h="",p=$("#webide-right").width()>40;window.ideRightStatus=p;var f=0,m=0,g=0,v=0,w=0,y=0,_=null,C=0,b=0,P=0,k={mediaChange:"mediaChange",pagePrepared:"pagePrepared",leftOk:"leftOk"},O=[],x=function(){var e={};return{get:function(t){return e[t]},set:function(t,i){e[t]=i}}}(),j={init:function(){var e=this;C=GlobalConfig("blur"),$("#video-container").on("click",".vjs-fullscreen-control",function(){clearInterval(window.fullScreenTimer),window.fullScreenTimer=null,window.fullScreenTimer=setInterval(function(){v++},1e3)}),$(document).on("mousemove",function(t){(t.pageX!=b||t.pageY!=P)&&(b=t.pageX,P=t.pageY,e.reset())}).on("keyup",function(){e.reset()}),e.interval()},interval:function(){clearInterval(window.actTimer),window.actTimer=null,window.actTimer=setInterval(function(){f++},1e3)},reset:function(){},setVideo:function(){},start:function(){f=0,m=0,g=0,v=0,w=0,$.post("/passport/user/loginhistory",{uid:OP_CONFIG.userInfo.uid,browser_key:OP_CONFIG.browser_key,from_course:l.course_id+"-"+l.id}),$.ajax({url:"/lesson/ajaxstartlearn",data:{cid:l.course_id,mid:l.id,rate:l.rate},type:"POST",dataType:"json",success:function(e){0==e.result&&(y=e.data)}})},end:function(e){var e=e||!0;clearInterval(window.fullScreenTimer),window.fullScreenTimer=null,v>w&&(w=v),g=0,f>m&&(m=f),y&&$.ajax({url:"/lesson/ajaxendlearn",type:"POST",dataType:"json",async:e,data:{record_id:y,act_time:m,full_time:w},success:function(){}}),y=0,f=0,m=0,v=0,w=0}};j.init();var I={back:function(){},backToCourse:function(){},expand:function(){var e=$(this),t=$(e.data("target")),i=$(".expand-block-mask");e.hasClass("on")?(e.removeClass("on"),t.removeClass("show"),i.remove()):(e.addClass("on"),t.addClass("show"),i=$('<div class="expand-block-mask"/>').appendTo("body"),i.on("click",function(){e.removeClass("on"),t.removeClass("show"),i.remove()}),R.onChaptersExpand())},pannel:function(e){var t=$(this),e=$(this).data("pannel"),i=null;i&&clearTimeout(i),i=setTimeout(function(){if(e){if($("#chapter-menu").hasClass("on")&&$("#chapter-menu").trigger("click"),t.hasClass("on"))return void R.hidePannel(e);$(".js-menu").removeClass("on"),t.addClass("on"),R.showPannel(e)}},30)}},T=function(){if(window.thePlayer){var e=0;if(window.thePlayer.getCurrentTime&&(e=window.thePlayer.getCurrentTime()||0),l){var t=n.get("_vt")||{},i=t[l.id];if($("#next-mask").hasClass("in"))return delete t[l.id],void n.set("_vt",t);i?(i.t=(new Date).getTime(),i.st=e):(i={t:(new Date).getTime(),st:e},t[l.id]=i),n.set("_vt",t)}}};$.extend(d.prototype,{init:function(e){this.wrap=$("#webide-right"),this.container=$("#"+this.key+"-pannel"),this.container.length||(this.container=$("<div />",{"class":"pannel",id:this.key+"-pannel"}).appendTo(this.wrap)),e.pclass&&this.container.addClass(e.pclass),void 0!=typeof e.showclose&&e.showclose===!1&&this.container.find(".pannel-close").remove(),this.bindEvents(),N.add(this.key,this)},hide:function(){var e="hidden"==$("#qa-pannel").css("visibility")&&"hidden"==$("#note-pannel").css("visibility");if($("#ide-pannel").addClass("active"),this.container.removeClass("active"),$(".js-menu[data-pannel="+this.key+"]").removeClass("on"),!window.ideRightStatus){var t=window.ideRightStatus;e||$("#ide-pannel .idemenu .js-ide-mini").click(),window.ideRightStatus=t}this.afterHide()&&this.afterHide()},show:function(){var e="hidden"==$("#qa-pannel").css("visibility")&&"hidden"==$("#note-pannel").css("visibility");if(this.wrap.find(".pannel").removeClass("active"),this.container.addClass("active"),!window.ideRightStatus){var t=window.ideRightStatus;e&&$("#ide-pannel .idemenu .js-ide-mini").click(),window.ideRightStatus=t}this.afterShow&&this.afterShow()},bindEvents:function(){var e=this;this.container.on("click.pannel","[data-action=close]",function(){e.hide()})},on:function(e,t){return this.methods=this.methods||{},this.methods[e]=t,this},trigger:function(e){var t=[].slice.call(arguments,1);this.methods[e]&&this.methods[e].apply(this,t)},register:function(e,t){return this[e]=t,this},param:function(e,t){var i=arguments;return i.length>1?void(this[e]=t):this[e]},getIdeStatus:function(){return""},setIdeStatus:function(){return""}});var N={inst:[],add:function(e,t){this[e]=t,this.inst.push(t)},get:function(e){return e?this[e]:this.inst}};OP_CONFIG.hasIde&&new d({key:"ide"}).register("aftershow",function(){}),new d({key:"qa",pclass:"white",showclose:OP_CONFIG.hasIde?!0:!1,init:!1}).register("loadPost",function(e,t,i){var t=t||0,n=$("#qa-pannel");n.find(".comp-loading").show(),n.find("#qa-list").hide(),$.getJSON("/lesson/ajaxquestionlist",{mid:l.id,type:e,page:t+1}).success(function(e){0!=e.result?($.alert(e.msg),n.find(".comp-loading").hide(),n.find("#qa-list").show()):i&&i(e)})}).register("QAhandle",function(e){var t=$("#qaListContainer").find(".curr").attr("data-type")-0+1,i={data:[]};return e.length<=0?$.extend(i,{callType:"lesson",qatype:t}):($.each(e,function(e,t){i.data.push({mid:"",chapter_seq:"",media_seq:"",media_title:"",title:t.question_title,uid:t.question_uid,user_img:t.question_user_head,answers:t.question_answer_num,view_num:t.question_view_num,create_time:t.question_update_time,answer_type:t.answer_type,answer_uid:t.answer_uid,answer_uname:t.answer_user_nickname||"",answer_description:o.replacehtml(t.answer_description)||"",answer_role_id:t.answer_user_role_id||"",qid:t.question_id,currentuid:OP_CONFIG.userInfo?OP_CONFIG.userInfo.uid:""})}),$.extend(i,{callType:"lesson",headimg:"hide"}))}).register("afterShow",function(){var e=this;this.param("inited")||($("#qa-pannel").css("backgroundColor","#F8FAFC;"),o.PutQAInit({input:".qa-input-text",close:".qa-input-close",button:".qa-input-button",qaList:"#qaListContainer",search:".js-qa-search-list",page:"lesson",cid:OP_CONFIG.curCourse.id,callback:function(){e.contentChange()}}),this.param("inited",!0),this.loadPost(0,0,function(t){e.render(e.QAhandle(t.data.data),t)}),this.bindEvents())}).register("bindEvents",function(){var e=this;$("#qa-pannel").on("click",".qa-nav a",function(){var t=this,i=$(this).attr("data-type"),n=$("#qaListContainer").find(".curr").attr("data-type");return n==i?!1:void e.loadPost(i,0,function(i){$(t).addClass("curr").siblings("a").removeClass("curr"),e.render(e.QAhandle(i.data.data),i)})}),$(window).on("resize",function(){e.contentChange()})}).register("render",function(e,t,i){var n=this,a=$("#qa-pannel");if(!i){var s=a.find(".pagination").html(""),r=$("#qaListContainer").find(".curr").attr("data-type");t.data.page.total>t.data.page.pageSize&&(pageInfo=t.data.page,s.pagination(pageInfo.total,{prev_text:"上一页",next_text:"下一页",items_per_page:pageInfo.pageSize,num_display_entries:3,num_edge_entries:2,callback:function(e){n.loadPost(r,e,function(e){n.render(n.QAhandle(e.data.data),e,!0)})}}))}o.render(e),a.find(".comp-loading").hide(),a.find("#qa-list").show(),setTimeout(function(){n.contentChange()},500)}).register("contentChange",function(){i.scrollbar.init(this.container.find(".scroll"),!0)}).register("afterHide",function(){R.trigger("afterPannelHide")}).register("reset",function(){var e=this,t=$("#qa-pannel"),i=$(".qa-input-text").val();i.length>0&&$(".qa-input-close").trigger("click"),t.find(".pagination").html(""),this.loadPost(0,0,function(t){e.render(e.QAhandle(t.data.data),t)})}),new d({key:"note",pclass:"white"}).on("publish",function(e){var t=this.param("curTabPannel"),i=this.getPostTpl(),n={},a="",o=t.find(".mod-post");n=e.data,n=this.formatPostData(n),a=juicer(i,n),o.find(".empty-holder").length&&o.find(".empty-holder").remove(),$(".i-verify-icon").hide(),a=$(a).hide(),o.prepend(a.fadeIn(600)),this.trigger("contentChange")}).register("getPostTpl",function(){return $("#note-post-tpl").html()}).register("formatPostData",function(e){var t=OP_CONFIG.userInfo.uid;return t==e.note_author_id&&(e.self=!0),e.note_picture_url&&(e.thumbs={small:e.note_picture_url,big:e.note_big_picture_url,time:e.note_time_point}),e}).register("loadPost",function(e,t,i,n){var a=this,i=i||0;a.noteXHR&&(a.noteXHR.abort(),a.noteXHR=null),a.noteXHR=$.getJSON("/lesson/ajaxnotelist",{mid:l.id,type:e,page:i+1}).success(function(i){var o=t.find(".mod-post"),s=a.rendPost(e,i.data);o.html(s),moco.imagePreview.init(".answerImg"),n&&n(i)})}).register("rendPost",function(e,t){{var i=this,n=this.getPostTpl(),a="";OP_CONFIG.userInfo.uid}return t.data.length?$.each(t.data,function(e,t){t=i.formatPostData(t),a+=juicer(n,t)}):(n=this.getEmptyPostTpl(),a=juicer(n,{type:"note",key:e})),a}).register("getEmptyPostTpl",function(){return $("#empty-holder-tpl").html()}).register("afterShow",function(){var e=this;return this.container.find(".js-verify-box").verifyCode(),1==this.param("inited")?void this.container.find(".js-verify-box").trigger("reset",0):($("#note-form").Form({init:function(){this.form.find(".js-verify-box").show().trigger("reset",0),$("#note-textarea").textarea({min:3,tip:function(e){var t=this.ipt.parents(".row:first").find(".ipt-tip");t.text(e.msg),0!=e.code?(this.ipt.data("error",!1),t.removeClass("error")):(this.ipt.data("error",!0),t.addClass("error"))}}),$("#note-textarea").on("focusin",function(){$(this).on("mousewheel",function(e){e.stopPropagation()})}),"video"==h&&this.form.find(".js-comp-switch").iswitch().show(),this.form.find(".js-comp-checkbox").checkbox(!0),this.form.find("input[name=verify]").on("blur keyup",function(){var e=$(this).val();e&&$(this).parents(".row:first").find(".ipt-tip").removeClass("error").text("")}).on("keydown",function(e){return 13==e.keyCode?($(".js-note-submit").click(),!1):void 0})},beforeSubmit:function(e){var t=this.form.find("input[name=verify]"),i=!1,n=$("#note-textarea"),a=this.form.find(".js-comp-switch:visible");return n.trigger("keyup"),0!=n.data("error")?(i=!0,this.submitBtn.removeClass("waiting"),n.focus(),!1):t.length&&!t.val()?(i=!0,this.showIptError(t,"验证码不能为空"),this.submitBtn.removeClass("waiting"),!1):t.val().length<4?(i=!0,this.showIptError(t,"验证码输入错误"),this.submitBtn.removeClass("waiting"),!1):a.length&&a.is(":not(.close)")&&(!F.getState()||"playing"!=F.getState()&&"paused"!=F.getState())?(i=!0,this.submitBtn.removeClass("waiting"),this.msg({msg:"请在视频播放时截图！",state:"error"}),!1):(a.is(":visible")&&a.data("selected")&&(e.pic_time=F.getPoint(),e.video=l.video_dir),e.mid=l.id,void this.submitBtn.text("正在提交..."))},success:function(e){return-103002==e.result?void this.msg({msg:"验证码错误",state:"error"}):0!=e.result?void this.opt.error.call(this,e):(N.note.trigger("publish",e),this.reset(),this.msg({msg:"发布笔记成功！",state:"success"}),void 0)},error:function(){this.msg({msg:"提交笔记失败！",state:"error"})},done:function(){this.submitBtn.text(this.submitBtn.data("text")),this.form.find(".js-verify-box").trigger("reset",0)},reset:function(){$("#note-textarea").data("$textarea").reset()}}),this.container.find(".js-tabs").itabs({change:function(t,i,n){var a=$(this).data("key"),o=i.data("key"),s=N[a];s.param("curTabItem",i),s.param("curTabPannel",n),s.loadPost(o,n,0,function(t){i.data("loaded",!0);var a=n.find(".pagination"),s={};t.data.page.total>t.data.page.pageSize&&(s=t.data.page,a.pagination(s.total,{prev_text:"上一页",next_text:"下一页",items_per_page:s.pageSize,num_display_entries:3,num_edge_entries:2,callback:function(t){e.loadPost(o,n,t,function(){e.trigger("contentChange")})}})),e.trigger("contentChange")}),e.trigger("contentChange")}}),void this.param("inited",!0))}).on("contentChange",function(){i.scrollbar.init(this.container.find(".scroll"),!0)}).register("reset",function(){var e=this.container.find(".js-tabs"),t=e.find(".tab-bars .bar-item"),i=e.find(".mod-post"),n=this.container.find(".js-comp-switch");"video"==h?n.iswitch().show():n.hide(),t.filter(".active").removeClass("active"),t.first().trigger("click"),i.html(""),e.find(".pagination").html(""),this.container.find(".js-verify-box").trigger("reset",0)}).register("afterHide",function(){R.trigger("afterPannelHide")});var q={tpl:function(){return $("#task-tpl").html()},render:function(e){var t=$("#task-placeholder"),i=this.tpl(),n="";n=juicer(i,e),t.html(n),this.makeScrollbar()},start:function(){window.thePlayer&&window.thePlayer.destroy&&(window.thePlayer.destroy(),window.thePlayer=null);var e=l;$("#video-container").html(""),this.show(),this.render(e),this.bindEvents(),OP_CONFIG.exp&&setTimeout($.proxy(function(){this.expTip(OP_CONFIG.exp)},this),8e3),0==OP_CONFIG.lastone&&OP_CONFIG.exp&&"undefined"!=typeof O&&0!=O.length&&this.qaTip(O),G.start(),u&&this.rendNext(u),i.eventProxy.emmit(k.leftOk)},show:function(){$(this.pannel).show()},hide:function(){$(this.pannel).hide()},destroy:function(e){this.hide(),G.send2(!1,null,e)},expTip:function(e){s(e)},qaTip:function(e){setTimeout(function(){r(e)},3e3)},makeScrollbar:function(){var e=$(this.pannel).find(".scroll");i.scrollbar.destroy(e),i.scrollbar.init(e,0),clearInterval(this.interval),this.interval=setInterval(function(){i.scrollbar.init(e)},500)},pannel:"#task-pannel",bindEvents:function(){$(document).off("click.task").on("click.task","#J_CodeQa",function(){$(this).find("dd").stop(!0).slideToggle()})},rendNext:function(e){var t=$("#next-media-tpl").html(),i=$("#task-next-holder");i.replaceWith(juicer(t,e))}},F={pannel:"#video-pannel",start:function(){this.show(),this.play(),u&&this.rendNext(u),G.start("video")},show:function(){$(this.pannel).show()},hide:function(){$(this.pannel).hide()},destroy:function(e){this.hide(),this.mask.hide(!0),G.send2(!1,null,e),this.inst&&this.inst.destroy()},pause:function(){window.thePlayer&&window.thePlayer.pause()},playVideo:function(){window.thePlayer&&window.thePlayer.play()},play:function(){a.stop();var e=this,t=0,i=null,o=l.id;i=n.get("_vt"),"number"!=typeof continueTime?i&&i[o]&&(t=i[o].st||0):t=continueTime,j.start(),window.thePlayer&&window.thePlayer.destroy&&(window.thePlayer.destroy(),window.thePlayer=null);for(var d=!0,c=[72,38,18,62,56,69,74,49,51,48,71,15,13,22,85,107],u=0;u<c.length;u++)c[u]==OP_CONFIG.curCourse.id&&(d=!1);var h="http://coding.imooc.com/lesson/m3u8h5?mid="+o+"&cid="+l.course_id;curProtocol=window.location.protocol.split(":")[0],"https"===curProtocol&&(h="https://coding.imooc.com/lesson/m3u8h5?mid="+o+"&cid="+l.course_id+"&ssl=1"),window.thePlayer=mocoplayer($("#video-container"),{url:h,title:l.name,showAd:d,currentTime:t,uid:OP_CONFIG.userInfo.uid,phone:OP_CONFIG.userInfo.phone,events:{onReady:function(){if("html5"==this.getPlayType()){var e=this,i=2e3;t||!d?i=0:$("#video-container").append('<div id="js-video-copyright" style="width:100%;height:100%;position:absolute;z-index:599;left:0;top:0;							    	background:#000 url(/static/module/common/img/copyright.png) no-repeat center center;background-size:100% auto"></div>'),_=$("#video-container video"),setTimeout(function(){$("#js-video-copyright").remove(),e.play(),a.start()},i)}},onComplete:function(){OP_CONFIG.exp?(s(OP_CONFIG.exp),0==OP_CONFIG.lastone&&"undefined"!=typeof O&&0!=O.length&&setTimeout(function(){r(O)},3e3),G.send2(!0,function(){G.reset()})):(G.send2(!0,function(e){e.experience?(s(e.experience),0==OP_CONFIG.lastone&&"undefined"!=e.push_ask&&0!=e.push_ask.length&&setTimeout(function(){r(e.push_ask)},3e3)):OP_CONFIG.exp&&(s(OP_CONFIG.exp),0==OP_CONFIG.lastone&&"undefined"!=typeof O&&0!=O.length&&setTimeout(function(){r(O)},3e3))}),G.reset()),e.mask.show(),G.reset(),j.end(),"html5"==this.getPlayType()&&a.stop()},onError:function(){}}})},getPoint:function(){var e=0;return window.thePlayer&&window.thePlayer.getCurrentTime&&(e=window.thePlayer.getCurrentTime()||0),Math.floor(e)},getState:function(){return window.thePlayer.getState()},resize:function(){},review:function(){this.mask.hide(),j.start(),"html5"==window.thePlayer.getPlayType()?($("#video-container").append('<div id="js-video-copyright" style="width:100%;height:100%;position:absolute;z-index:599;left:0;top:0;				    	background:#000 url(/static/module/common/img/copyright.png) no-repeat center center;background-size:100% auto"></div>'),setTimeout(function(){$("#js-video-copyright").remove(),a.start(),window.thePlayer.play()},2e3)):window.thePlayer.play()},mask:function(){return{dom:$("#next-mask"),show:function(){this.dom.addClass("in")},hide:function(){this.dom.removeClass("in")}}}(),rendNext:function(e){var t=$("#next-media-tpl").html(),i=$("#next-media-content");i.html(juicer(t,e))}},G=function(){return function(e){if(OP_CONFIG.userInfo){var t=e,i={},n=(new Date).getTime(),a=((new Date).getTime(),null),o="",s=function(e,a,s){var r,d;r=(new Date).getTime(),d=parseInt(r-n)/1e3,i.mid=s||l.id,i.learn_time=d,i.mode=o,"video"==o&&(i.video_point=t.getPoint());var c={url:"/lesson/ajaxmediauser/",data:i,type:"POST",dataType:"json",success:function(e){0==e.result?(n=r,a&&a(e.data),e.data.experience&&(OP_CONFIG.exp=e.data.experience,0==OP_CONFIG.lastone&&"undefined"!=e.data.push_ask&&0!=e.data.push_ask.length&&(O=e.data.push_ask))):"-105002"==e.result&&$.alert("你的账号在另一地点登录，已被强迫下线。",{info:"如果不是本人操作，建议你修改密码。",callback:function(){window.location.href="//coding.imooc.com"}})}},u=u||!0;u===!1&&(c.async=!1),$.ajax(c)},r=function(){a=window.setInterval(function(){s(!0,function(e){t.inst&&t.inst.emmit("mpRaised",e)})},6e4)},d={send2:function(e,t,i){s(e,t,i)},reset:function(){n=(new Date).getTime(),a&&clearInterval(a),a=null},start:function(e){o=e||"task",this.reset(),r()}};return d.start(),window.onbeforeunload=function(){l&&T(),s(!1),j.end(!1)},d}}(F)}(),S={collect:function(e){var t=$(this);t.hasClass("on")||$.post("/lesson/ajaxcollectnote",{note_id:e},null,"json").success(function(e){0==e.result&&t.addClass("on").find("em").text(function(e,t){return++t})})},praise:function(e){var t=$(this);t.hasClass("waiting")||(t.addClass("on waiting"),$.post("/lesson/ajaxsupportnote",{note_id:e},function(e){0==e.result&&t.data("action","unpraise").find(".ac-icon i").attr("class","sz-thumb praise-anim").end().find("em").text(function(e,t){return++t})},"json").error(function(){alert("出错啦~")}).complete(function(){t.removeClass("waiting")}))},unpraise:function(e){var t=$(this);t.hasClass("waiting")||(t.removeClass("on"),$.post("/lesson/ajaxdelsupportnote",{note_id:e},function(e){0==e.result&&t.data("action","praise").find(".ac-icon i").attr("class","sz-thumb-o").end().find("em").text(function(e,t){return--t})},"json").error(function(){alert("出错啦~")}).complete(function(){t.removeClass("waiting")}))},edit:function(e){var t=$(this).parents(".post-row"),i=$("#cnt-update-save").clone(),n=(t.find(".js-post-cnt"),t.find(".js-post-edit")),a=n.html()||"";t.hasClass("editable")||(t.addClass("editable"),n.attr("contenteditable",!0).data("old",a),i.insertAfter(n).attr("id","post-update-"+e).find(".post-update-tip").text("").hide().end().find(".js-post-update").data("nid",e).end().show())},del:function(e){var t=$(this).parents(".post-row");t.hasClass("deleted")||$.imodal.confirm({content:'你确定要删除笔记吗？<br/><span class="smaller">笔记删除将无法恢复</span>'}).then(function(i){"yes"===i&&(t.addClass("deleted").animate({opacity:0,padding:0,height:0},800,function(){$(this).remove()}),$.post("/lesson/ajaxdelmynote",{note_id:e}).success(function(){}))})},update:function(e){var t=$(this).parents(".post-row"),i=t.find(".js-post-cnt"),n=t.find(".js-post-edit"),a=n.val().trim()||"",o={},s=t.find(".post-update-tip");return a.length<3||a.length>300?void s.text("内容长度应为3-300个字符").show():(s.text("").hide(),o.note_id=e,o.content=a,void $.post("/lesson/ajaxeditmynote",o).success(function(){t.removeClass("editable"),i.html(a),n.removeAttr("contenteditable"),$("#post-update-"+e).hide().remove()}))}};$(".js-verify").bind("input propertychange focus",function(){var e=$(this),t=e.val();4==t.length?$.ajax({url:"/user/checkverify",data:{id:"mediaVerifyCode",verify:t},dataType:"json",success:function(t){"0"==t.result?e.siblings(".i-verify-icon").show():e.siblings(".i-verify-icon").hide()}}):e.siblings(".i-verify-icon").hide()});var E={mode:"",init:function(){var e=this;e.prepare(),i.eventProxy.on(k.mediaChange,function(t){e.change(t)}),i.eventProxy.emmitOne("contentReady")},rend:function(){u?u.cid=l.course_id:u={cid:l.course_id,over:1},this.inst.start()},prepare:function(){this.mode=l.type,2==this.mode?this.inst=q:1==this.mode&&(this.inst=F)},change:function(e){e.oid!=e.nid&&this.inst.destroy(e.oid),this.prepare(),this.rend()}},R={init:function(){var e=this,t=$.hash("mid");OP_CONFIG.mid=t,t&&(OP_CONFIG.oldie||(OP_CONFIG.mid=t,this.state={},n.get("webide_guided")||x.set("guide",!0),this.loadMedia(t,function(){h=1==l.type?"video":"task";var t={left:"#webide-left",right:"#webide-right",dragger:"#webide-drag",container:"#webide-layout",stop:function(){$(window).trigger("layoutChange")}};i.idrag.create(t),E.init(),e.renderPannels(),$(window).hashchange(function(){T();var t=$.hash("mid");t&&e.switchMedia(t)})}),i.eventProxy.on(k.mediaChange,function(){e.setMediaName(),e.resetChapters(),1==l.type?h="video":2==l.type&&(h="task"),document.title=i.unescapeHtml(l.chapter_seqid+"-"+l.seqid+" "+l.name)+"_慕课网";var t=null,n=null;$.each(N.get(),function(e,i){i.container.is(".active")?t=i:n=i}),n&&n.param("inited")&&n.reset(),t&&t.param("inited")&&t.reset(),"undefined"!=typeof window.ide&&ide.inst.triggerEvent("miniStateChanged",!+l.open_ide)}).on(k.pagePrepared,function(){e.hidePageLoad(),n.get("webide_guided")||setTimeout(function(){M.init()},0)}).all("contentReady ideReady",function(){ide&&ide.inst.triggerEvent("miniStateChanged",!+l.open_ide)}),this.bindEvents()))},properties:function(){this.pid=OP_CONFIG.marking,this.$layout=$("#webide-layout"),this.$layoutLeft=$("#webide-left"),this.$layoutRight=$("#webide-right"),this.$mediaName=$("#g-media-name"),this.$pageLoad=$("#pageload"),this.$pageBlock=$("#page-block"),this.$pageBlockMsg=$("#page-block-msg")},setState:function(e){$.extend(this.state,e)},isMini:function(){return this.state.mini},hidePageLoad:function(){this.$pageLoad.addClass("out").fadeOut(300)},loadMedia:function(e,t,n){j.end(),$.ajax({url:"/lesson/ajaxmediainfo",data:{mid:e,cid:OP_CONFIG.curCourse.id},type:"get",dataType:"json",success:function(n){if(0==n.result&&n.data){var a=l.id||e;l=n.data.media_info,u=n.data.next_media_info||null,OP_CONFIG.exp=n.data.experience,OP_CONFIG.mid=l.id,OP_CONFIG.lastone=n.data.media_info.lastone,0==OP_CONFIG.lastone&&"undefined"!=n.data.push_ask&&(O=n.data.push_ask),t&&t(),i.eventProxy.emmit(k.mediaChange,{oid:a,nid:e})}else-11==n.result?window.location.href=window.location.protocol+"//"+window.location.host:-102005==n.result?window.location.href=window.location.protocol+"//"+window.location.host+"/error/noexists":-105002==n.result&&$.alert("你的账号在另一地点登录，已被强迫下线。",{info:"如果不是本人操作，建议你修改密码。",callback:function(){window.location.href="//coding.imooc.com"}})},complete:function(){"function"==typeof n&&n()}})},switchMedia:function(e){$("#chapter-menu.on").trigger("click");var t=this.$pageBlock.show(),i=null;i=setTimeout($.proxy(function(){this.$pageBlockMsg.show()},this),2e3),this.loadMedia(e,null,function(){t.hide(),i&&(clearTimeout(i),i=null)})},createIde:function(){var e=this.pid,t=this;require(["ide"],function(n){n.edit&&n.edit("#ide-pannel",{ajax:{urlPrefix:"/webide/",data:{marking:e}},minified:function(e){t.onIdeMinified(e)},projectId:OP_CONFIG.projectId,projectSSH:OP_CONFIG.projectSSH,projectUrl:OP_CONFIG.projectUrl,httpService:OP_CONFIG.httpService,termService:OP_CONFIG.termService,termAutoOpen:OP_CONFIG.termAutoOpen,pythonSw:OP_CONFIG.pythonSw}).ready(function(){i.eventProxy.emmitOne("ideReady")})})},renderPannels:function(){var e=N.get("ide");if(e)e.show(),0==OP_CONFIG.backup_status?this.createIde():this.backup();else{var t=$(".js-menu[data-pannel]");t.first().click().data("sleep",!0),t.filter(function(){return"note"==$(this).data("pannel")}).parent().hide()}i.eventProxy.emmit(k.pagePrepared)},backup:function(e){e||this.onIdeMinified(!0),this.backupEvent();var t=$("#webide-backup-tpl").html(),i="";i=juicer(t,{backup_status:OP_CONFIG.backup_status}),$("#ide-pannel").html(i),e&&$("#ide-pannel").children(".webide-backup").addClass("on")},backupEvent:function(){var e=this,t=$("#ide-pannel"),i=null,n=function(){a(),clearTimeout(i),i=setTimeout(function(){a()},1e4)},a=function(){$.post("/project/recoverok",{marking:OP_CONFIG.marking},function(t){0==t.result&&e.createIde()},"json")};4==OP_CONFIG.backup_status&&n(),t.on("click",".webide-backup-sidebar",function(){var i=t.children(".webide-backup");i.hasClass("on")?(e.onIdeMinified(!0),i.removeClass("on")):(e.onIdeMinified(!1),i.addClass("on"))}),t.on("click",".js-openide",function(){$.post("/project/recover",{marking:OP_CONFIG.marking},function(t){0==t.result?(OP_CONFIG.backup_status=4,e.backup(!0),n()):$.alert(t.msg)},"json")});$(".webide-backup");$(window).on("resize",function(){return $(".webide-backup").hasClass("on")?void($(".webide-backup").width()<364&&t.find(".webide-backup-sidebar").click()):!1})},setMediaName:function(){this.$mediaName.html(l.chapter_seqid+"-"+l.seqid+" "+l.name)},loadChapters:function(e,t){var n=$("#chapter-tpl").html(),a="";a=juicer(n,{data:e}),t.find(".comp-loading").hide().end().prepend(a);var o=$("#chapter-scrollbar");i.scrollbar.init(o,function(){var e=o.find(".cur"),t=e.parent(),n=0,a=o.height(),n=t.position().top;n>a&&(o.scrollTop(n-t.height()),i.scrollbar.update(o))})},resetChapters:function(){$(".js-chapters").data("loaded",!1).data("refresh",!0)},onChaptersExpand:function(){var e=this,t=$(".js-chapters");if(!t.hasClass("loading")&&!t.data("loaded")){if(t.addClass("loading"),t.data("refresh")){var i=t.find(".comp-loading").clone();t.html(i)}$.get("/lesson/ajaxchapterlist",{v:(new Date).getTime(),mid:l.id},null,"json").success(function(i){t.data("loaded",!0),e.loadChapters(i.data,t)}).complete(function(){t.removeClass("loading")})}},onIdeMinified:function(e){var t=this.$layoutLeft,i=this.$layoutRight,n="",a="";e?(n=t.attr("style"),a=i.attr("style"),t.data("style",n),i.data("style",a),i.css({width:"40",right:0,left:"auto"}),t.css({width:"auto",right:40})):(n=t.data("style"),a=i.data("style"),n?t.attr("style",n):t.removeAttr("style"),a?i.attr("style",a):i.removeAttr("style")),this.$layout.toggleClass("webide-mini"),this.setState({mini:e})},on:function(e,t){this.$layout.on(e,$.proxy(t,this))},trigger:function(e,t){this.$layout.trigger(e,this,t)},showPannel:function(e){this.trigger("beforePannelShow"),N[e]&&N[e].show()},hidePannel:function(e){N[e]&&N[e].hide(),this.trigger("afterPannelHide")},bindEvents:function(){$(document).on("click.webide","[data-action]",function(){if($(this).data("sleep"))return!1;var e=$(this).data("action");e&&I[e]&&I[e].call(this)}).on("click",".js-media",function(e){var t=($(".js-chapters"),$(this).data("id"));if(!$(this).is(".cur"))return $.hash("mid",t),e.preventDefault(),!1}).on("click",".post-action",function(){var e=$(this).data("action"),t=$(this).data("mid");return S[e]&&S[e].call(this,t),!1}).on("click",".js-post-update",function(){var e=$(this).data("nid");e&&S.update.call(this,e)}).on("click",".js-view-again",function(){F.review()}),moco.imagePreview.init(".answerImg")}},M=function(e){for(var t,i,a,o,s,r='<div class="ide-guide-modal-wrap ide-guide-animate"><div class="ide-guide-modal"><div class="inner ide-guide-animate"><div class="top"></div><div class="bottom"><div class="dots"></div><a href="javascript:;" class="modal-btn">继续</a><span class="close-tip">不用了，谢谢</span></div></div></div></div>',d='<div class="guide-slider"><img src="{src}" alt=""></div>',c='<div class="ide-guide-modal-block"></div>',l="",u="",h=0,p=4,f="/static/module/common/img/ideguide/",m=0;4>m;m++)l+="<span></span>",u+=d.replace("{src}",f+(m+1)+".gif");var g=function(){i=$(r),i.find(".top").html(u),s=i.find(".guide-slider"),t=i.find(".dots"),o=$(c),t.html(l),o.appendTo("body").offset(),o.addClass("showed"),i.appendTo("body"),a=i.find(".ide-guide-modal"),a.offset(),a.addClass("showed"),t.on("click","span",function(){var e=$(this).index();h=e,v()}),i.on("click",".modal-btn",function(){v()}).on("click",".close-tip",function(){_()}),e.start(),v()},v=function(){return h++,h>p?void _():(h==p?i.find(".modal-btn").text("开始学习").end().find(".close-tip").hide():i.find(".modal-btn").text("继续").end().find(".close-tip").show(),void w(h))},w=function(e){s.hide().eq(e-1).show(),t.find("span").removeClass("on").eq(e-1).addClass("on")},y=function(){i.remove(),o.remove()},_=function(){y(),e.end(),n.set("webide_guided",!0)};return{init:g}}({start:function(){},end:function(){1==E.mode&&E.inst.playVideo(),x.set("guide",!1)}});juicer.register("spaceUrl",function(e,t){var i=OP_CONFIG.spaceUrl[t];return i+=e}),juicer.register("plus",function(e){return parseInt(e)+1});var A=function(){c=OP_CONFIG.curCourse||{},R.properties(),R.init(),$("textarea").on("keydown",function(e){e.stopPropagation()}),$("#webide-right").on("click",".js-ide-mini",function(){window.ideRightStatus=$("#webide-right").width()>40}),window.App=R};A()});