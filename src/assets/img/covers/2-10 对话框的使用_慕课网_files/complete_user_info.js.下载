define("common/js/complete_user_info",["require","jqueryValidate"],function(){jQuery.validator.addMethod("phoneb",function(i,e){var s=/^(13[0-9]|14[56789]|15[012356789]|16[6]|17[0-9]|18[0-9]|19[89])[0-9]{8}$/g;return this.optional(e)||s.test(i)}),jQuery.validator.addMethod("email",function(i,e){var s=/^[a-zA-Z0-9]+([._\-][a-zA-Z0-9]+)*@([a-zA-Z0-9]+([._\-][a-zA-Z0-9]+))+$/;return this.optional(e)||s.test(i)}),jQuery.validator.addMethod("password",function(i,e){var s=/^[\w~`!@#$%&*()_+<>?:"'+*\/\-\^\\\][{}]{6,16}$/;return this.optional(e)||s.test(i)});var i,e=$("#improve-mode"),s=0,t="",r=0,o=0,n="";window.onload=function(){function d(){var i=$(".moco-modal-layer"),e=$(window).width(),s=$(window).height(),t=$(".moco-modal-layer").width(),r=$(".moco-modal-layer").height(),o=e/2-t/2,n=s/2-r/2;i.size()>0&&$(".moco-modal-layer").css({left:o,top:n})}if(e.size()>0){-1!=location.href.indexOf("lesson")&&1==OP_CONFIG.completelearn&&(1==OP_CONFIG.completeuinfotype||2==OP_CONFIG.completeuinfotype)&&(window.location.href="//www.imooc.com/index/usercheck?type=1&uid="+OP_CONFIG.userInfo.uid),s=0;var l=$("#improve-mode").prop("outerHTML"),g=$.dialog(l,{title:"完善个人信息",modal:!0});g.boxy.find(".moco-icon-close").hide();var u=function(i){clearInterval(o),o=null,n=i.code,t=i.pubkey,r=i.servertime,setInterval(function(){r++},1e3)},c=$(".moco-modal-layer .improve").data("flag");switch(i=$(".moco-modal-layer .improve").validate({errorPlacement:function(i,e){$(e).closest(".box").find(".help-inline").html("").append($(i))}}),c){case 1:$(".moco-modal-layer .js-phone").rules("add",{required:!0,phoneb:!0,messages:{required:"请输入手机号码",phoneb:"请输入正确的手机号码"}}),$(".moco-modal-layer .js-mobileverify").rules("add",{required:!0,messages:{required:"请输入验证码"}}),$(".moco-modal-layer .js-email").rules("add",{required:!0,email:!0,messages:{required:"请输入邮箱",email:"请输入正确的邮箱地址"}}),$(".moco-modal-layer .js-password").rules("add",{required:!0,password:!0,messages:{required:"请输入登录密码",password:"密码格式不正确"}});break;case 2:$(".moco-modal-layer .js-phone").rules("add",{required:!0,phoneb:!0,messages:{required:"请输入手机号码",phoneb:"请输入正确的手机号码"}}),$(".moco-modal-layer .js-mobileverify").rules("add",{required:!0,messages:{required:"请输入验证码"}});break;case 3:$(".moco-modal-layer .js-email").rules("add",{required:!0,email:!0,messages:{required:"请输入邮箱",email:"请输入正确的邮箱地址"}})}}window.onresize=function(){d()},$(".moco-modal-layer").delegate(".js-phone","change",function(){s=0}),$(".moco-modal-layer").on("click",".getCode",function(){var i=$(this);if(i.hasClass("sending"))return!1;i.addClass("sending"),i.closest(".improve").find(".js-phone").siblings(".help-inline").html("");var e,t=$(".moco-modal-layer .getCode"),r=60;e=setInterval(function(){if(0>=r)clearInterval(e),i.closest(".improve").find(".js-phone").siblings(".help-inline").html(""),t.text("重新发送"),i.removeClass("sending");else{var s="获取验证码["+--r+"]";t.text(s)}},1e3);var o=$(".moco-modal-layer .js-phone").val(),n={phone:o,noverify:1};1==s&&(n.forcebind=1),$.ajax({url:"/passport/user/checkphonecode",type:"post",data:n,dataType:"json",success:function(t){if(10001!=t.status)if(90013==t.status){var r='手机号码已被使用，是否强制绑定到现有账户中？<i class="js-mandatory-yes">是</i>';i.closest(".improve").find(".js-phone").siblings(".help-inline").html(r),clearInterval(e),i.html("获取验证码"),s=0}else 11011==t.status?$.alert(t.msg):11012==t.status?$.alert(t.msg):(i.closest(".improve").find(".js-phone").siblings(".help-inline").html(t.msg),clearInterval(e),i.removeClass("sending"),i.html("获取验证码"))}})}).on("click",".submitBtn",function(){var e=$(this),t=$(".moco-modal-layer .js-phone").val(),o=$(".moco-modal-layer .js-mobileverify").val(),d=$(".moco-modal-layer .js-email").val(),l=$(".moco-modal-layer .js-password").val();if(i.form()){$(".moco-modal-layer .js-password").size()>0&&($.ajax({url:"/passport/user/prelogin",async:!1,type:"post",dataType:"json",success:function(i){10001==i.status&&u(i)}}),l=a(n+"	"+r+"	"+l),l=window.btoa(l));var g={phone:t,mobileverify:o,email:d,password:l};1==s&&(g.forcebind=1),$.ajax({url:"/passport/user/completeuserinfo",type:"post",data:g,dataType:"json",success:function(i){if(10001!=i.status&&11010!=i.status)if(90013==i.status){var e='手机号码已被使用，是否强制绑定到现有账户中？<i class="js-mandatory-yes">是</i>';$(".js-phone").siblings(".help-inline").html(e),$(".moco-modal-layer").find(".getCode").addClass("sending"),s=0}else if(11011==i.status)$.alert(i.msg);else if(11012==i.status)$.alert(i.msg);else for(var t in i.data)$(".js-"+t).closest(".box").find(".help-inline").html(i.data[t].msg);else 11010==i.status?window.location.href=window.location.href:($(".js-modal-close").click(),$.alert("恭喜你，完善个人信息成功"))},error:function(){e.closest(".box").find("help-inline").html("服务器无响应，稍后重试")}})}}).on("click",".js-pw",function(){$(this).hasClass("cur")?($(".moco-modal-layer .js-password").attr("type","password"),$(this).removeClass("cur")):($(".moco-modal-layer .js-password").attr("type","text"),$(this).addClass("cur"))}).on("click",".cancelBtn",function(){$(".js-modal-close").click()}),$(".help-inline").delegate(".js-mandatory-yes","click",function(){s=1,$(".moco-modal-layer").find(".getCode").removeClass("sending"),$(".getCode").trigger("click"),$(this).parent(".help-inline").html("")})};var a=function(i){function e(i){O=i,_=new Array(O);for(var e=0;e<_.length;e++)_[e]=0;P=new s,F=new s,F.digits[0]=1}function s(i){this.digits="boolean"==typeof i&&1==i?null:_.slice(0),this.isNeg=!1}function r(i){var e=new s(!0);return e.digits=i.digits.slice(0),e.isNeg=i.isNeg,e}function o(i){var e=new s;e.isNeg=0>i,i=Math.abs(i);for(var t=0;i>0;)e.digits[t++]=i&H,i>>=G;return e}function n(i){var e,s=48,t=s+9,r=97,o=r+25,n=65,a=90;return e=i>=s&&t>=i?i-s:i>=n&&a>=i?10+i-n:i>=r&&o>=i?10+i-r:0}function a(i){for(var e=0,s=Math.min(i.length,4),t=0;s>t;++t)e<<=4,e|=n(i.charCodeAt(t));return e}function d(i){for(var e=new s,t=i.length,r=t,o=0;r>0;r-=4,++o)e.digits[o]=a(i.substr(Math.max(r-4,0),Math.min(r,4)));return e}function l(i){for(var e="",s=m(i);s>-1;--s)e+=g(i.digits[s]);return e}function g(i){var e=String.fromCharCode(255&i);i>>>=8;var s=String.fromCharCode(255&i);return s+e}function u(i,e){var t;if(i.isNeg!=e.isNeg)e.isNeg=!e.isNeg,t=c(i,e),e.isNeg=!e.isNeg;else{t=new s;for(var r,o=0,n=0;n<i.digits.length;++n)r=i.digits[n]+e.digits[n]+o,t.digits[n]=65535&r,o=Number(r>=Z);t.isNeg=i.isNeg}return t}function c(i,e){var t;if(i.isNeg!=e.isNeg)e.isNeg=!e.isNeg,t=u(i,e),e.isNeg=!e.isNeg;else{t=new s;var r,o;o=0;for(var n=0;n<i.digits.length;++n)r=i.digits[n]-e.digits[n]+o,t.digits[n]=65535&r,t.digits[n]<0&&(t.digits[n]+=Z),o=0-Number(0>r);if(-1==o){o=0;for(var n=0;n<i.digits.length;++n)r=0-t.digits[n]+o,t.digits[n]=65535&r,t.digits[n]<0&&(t.digits[n]+=Z),o=0-Number(0>r);t.isNeg=!i.isNeg}else t.isNeg=i.isNeg}return t}function m(i){for(var e=i.digits.length-1;e>0&&0==i.digits[e];)--e;return e}function h(i){var e,s=m(i),t=i.digits[s],r=(s+1)*T;for(e=r;e>r-T&&0==(32768&t);--e)t<<=1;return e}function f(i,e){for(var t,r,o,n=new s,a=m(i),d=m(e),l=0;d>=l;++l){for(t=0,o=l,j=0;a>=j;++j,++o)r=n.digits[o]+i.digits[j]*e.digits[l]+t,n.digits[o]=r&H,t=r>>>G;n.digits[l+a+1]=t}return n.isNeg=i.isNeg!=e.isNeg,n}function v(i,e){var t,r,o;result=new s,t=m(i),r=0;for(var n=0;t>=n;++n)o=result.digits[n]+i.digits[n]*e+r,result.digits[n]=o&H,r=o>>>G;return result.digits[1+t]=r,result}function p(i,e,s,t,r){for(var o=Math.min(e+r,i.length),n=e,a=t;o>n;++n,++a)s[a]=i[n]}function y(i,e){var t=Math.floor(e/T),r=new s;p(i.digits,0,r.digits,t,r.digits.length-t);for(var o=e%T,n=T-o,a=r.digits.length-1,d=a-1;a>0;--a,--d)r.digits[a]=r.digits[a]<<o&H|(r.digits[d]&L[o])>>>n;return r.digits[0]=r.digits[a]<<o&H,r.isNeg=i.isNeg,r}function w(i,e){var t=Math.floor(e/T),r=new s;p(i.digits,t,r.digits,0,i.digits.length-t);for(var o=e%T,n=T-o,a=0,d=a+1;a<r.digits.length-1;++a,++d)r.digits[a]=r.digits[a]>>>o|(r.digits[d]&V[o])<<n;return r.digits[r.digits.length-1]>>>=o,r.isNeg=i.isNeg,r}function N(i,e){var t=new s;return p(i.digits,0,t.digits,e,t.digits.length-e),t}function $(i,e){var t=new s;return p(i.digits,e,t.digits,0,t.digits.length-e),t}function b(i,e){var t=new s;return p(i.digits,0,t.digits,0,e),t}function k(i,e){if(i.isNeg!=e.isNeg)return 1-2*Number(i.isNeg);for(var s=i.digits.length-1;s>=0;--s)if(i.digits[s]!=e.digits[s])return i.isNeg?1-2*Number(i.digits[s]>e.digits[s]):1-2*Number(i.digits[s]<e.digits[s]);return 0}function C(i,e){var t,o,n=h(i),a=h(e),d=e.isNeg;if(a>n)return i.isNeg?(t=r(F),t.isNeg=!e.isNeg,i.isNeg=!1,e.isNeg=!1,o=c(e,i),i.isNeg=!0,e.isNeg=d):(t=new s,o=r(i)),new Array(t,o);t=new s,o=i;for(var l=Math.ceil(a/T)-1,g=0;e.digits[l]<Q;)e=y(e,1),++g,++a,l=Math.ceil(a/T)-1;o=y(o,g),n+=g;for(var f=Math.ceil(n/T)-1,p=N(e,f-l);-1!=k(o,p);)++t.digits[f-l],o=c(o,p);for(var $=f;$>l;--$){var j=$>=o.digits.length?0:o.digits[$],b=$-1>=o.digits.length?0:o.digits[$-1],C=$-2>=o.digits.length?0:o.digits[$-2],M=l>=e.digits.length?0:e.digits[l],z=l-1>=e.digits.length?0:e.digits[l-1];t.digits[$-l-1]=j==M?H:Math.floor((j*Z+b)/M);for(var q=t.digits[$-l-1]*(M*Z+z),x=j*B+(b*Z+C);q>x;)--t.digits[$-l-1],q=t.digits[$-l-1]*(M*Z|z),x=j*Z*Z+(b*Z+C);p=N(e,$-l-1),o=c(o,v(p,t.digits[$-l-1])),o.isNeg&&(o=u(o,p),--t.digits[$-l-1])}return o=w(o,g),t.isNeg=i.isNeg!=d,i.isNeg&&(t=d?u(t,F):c(t,F),e=w(e,g),o=c(e,o)),0==o.digits[0]&&0==m(o)&&(o.isNeg=!1),new Array(t,o)}function M(i,e){return C(i,e)[0]}function z(i){this.modulus=r(i),this.k=m(this.modulus)+1;var e=new s;e.digits[2*this.k]=1,this.mu=M(e,this.modulus),this.bkplus1=new s,this.bkplus1.digits[this.k+1]=1,this.modulo=q,this.multiplyMod=x,this.powMod=A}function q(i){var e=$(i,this.k-1),s=f(e,this.mu),t=$(s,this.k+1),r=b(i,this.k+1),o=f(t,this.modulus),n=b(o,this.k+1),a=c(r,n);a.isNeg&&(a=u(a,this.bkplus1));for(var d=k(a,this.modulus)>=0;d;)a=c(a,this.modulus),d=k(a,this.modulus)>=0;return a}function x(i,e){var s=f(i,e);return this.modulo(s)}function A(i,e){var t=new s;t.digits[0]=1;for(var r=i,o=e;;){if(0!=(1&o.digits[0])&&(t=this.multiplyMod(t,r)),o=w(o,1),0==o.digits[0]&&0==m(o))break;r=this.multiplyMod(r,r)}return t}function I(i){var e=1024;this.e=d("10001"),this.d=d(""),this.m=d(i),this.chunkSize="number"!=typeof e?2*m(this.m):e/8,this.radix=16,this.barrett=new z(this.m)}function S(i){var e,r,o,n,a,d,g,u,c=new Array,m=i.length,h="",f=new I(t);for(m>f.chunkSize-11&&(m=f.chunkSize-11),e=0,r=m-1;m>e;)c[r]=i.charCodeAt(e),e++,r--;for(r=f.chunkSize-m%f.chunkSize;r>0;){for(n=Math.floor(256*Math.random());!n;)n=Math.floor(256*Math.random());c[e]=n,e++,r--}for(c[m]=0,c[f.chunkSize-2]=2,c[f.chunkSize-1]=0,a=c.length,e=0;a>e;e+=f.chunkSize){for(d=new s,r=0,o=e;o<e+f.chunkSize;++r)d.digits[r]=c[o++],d.digits[r]+=c[o++]<<8;g=f.barrett.powMod(d,f.e),u=l(g),h+=u}return h}var O,_,P,F,G=16,T=G,Z=65536,Q=Z>>>1,B=Z*Z,H=Z-1;e(20);var L=(o(1e15),new Array("0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"),new Array("0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"),new Array(0,32768,49152,57344,61440,63488,64512,65024,65280,65408,65472,65504,65520,65528,65532,65534,65535)),V=new Array(0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535);return e(131),S(i)}});